build-libiosuhax:
    stage: libraries
    script:
        - pacman --noconfirm -U $CI_PROJECT_DIR/packages/wut/*.pkg*
        - source /etc/profile.d/*
        - cd $CI_PROJECT_DIR/packages/libiosuhax
        - chmod -R 0777 .
#       Set up a builduser, because makepkg -_-
        - useradd builduser -m
        - passwd -d builduser
        - echo "builduser ALL=(ALL) ALL" | tee -a /etc/sudoers
#       Build!
        - sudo -E -u builduser makepkg -s --noconfirm
    artifacts:
        paths:
            - 'packages/libiosuhax/*.pkg*'
    only:
        changes:
            - 'packages/libiosuhax/PKGBUILD'
            - 'packages/libiosuhax/ci.yml'
            - 'packages/libiosuhax/iosuhaxv0.3-custinstallloc.patch'
#        variables:
#            - $TRY_CACHE == "yes"
